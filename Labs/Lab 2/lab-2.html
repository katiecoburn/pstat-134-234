<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lab 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="lab-2_files/libs/clipboard/clipboard.min.js"></script>
<script src="lab-2_files/libs/quarto-html/quarto.js"></script>
<script src="lab-2_files/libs/quarto-html/popper.min.js"></script>
<script src="lab-2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="lab-2_files/libs/quarto-html/anchor.min.js"></script>
<link href="lab-2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lab-2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="lab-2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="lab-2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="lab-2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 2</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="application-programming-interfaces-apis" class="level2">
<h2 class="anchored" data-anchor-id="application-programming-interfaces-apis">Application Programming Interfaces (APIs)</h2>
<p>Two R packages that make working with APIs relatively easy are <code>httr</code> and <code>jsonlite</code>. If you don’t have these packages already, you will need to install them with <code>install.packages()</code> before rendering this file or running the following code chunks. The corresponding Python libraries are <code>requests</code> and <code>json</code>. Make sure to install them using <code>py_install()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(c("httr", "jsonlite"))</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'jsonlite' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.4.2     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter()  masks stats::filter()
✖ purrr::flatten() masks jsonlite::flatten()
✖ dplyr::lag()     masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reticulate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'reticulate' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># py_install(c("requests", "json"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="quick-apis-no-keys" class="level2">
<h2 class="anchored" data-anchor-id="quick-apis-no-keys">Quick APIs (No Keys)</h2>
<p>There are many, many public APIs available (and many ways to access them). In this class we’ll cover how to make requests from several different APIs within R or Python. For a lengthy list of public APIs, I recommend <a href="https://github.com/public-apis/public-apis">this GitHub repository</a>.</p>
<section id="open-notify-api" class="level3">
<h3 class="anchored" data-anchor-id="open-notify-api">Open Notify API</h3>
<p>This API is an open-source project meant to provide a simple interface for some fun data from NASA. You can get more information on it here: <a href="http://open-notify.org/" class="uri">http://open-notify.org/</a> We’ll start out with what is quite possibly one of the simplest APIs out there – one that will tell us <a href="http://open-notify.org/Open-Notify-API/People-In-Space/">how many human beings are currently in space</a> (and, if known, on which craft).</p>
<p>Note that this data – the number of people currently in space – probably doesn’t change all that often. You can imagine that the number of people in space last night was probably the same as the number in space right now. We aren’t really taking advantage of one of the big strengths of an API yet (the ability to constantly access brand-new up-to-date information), but we will eventually.</p>
<section id="requests-using-r" class="level4">
<h4 class="anchored" data-anchor-id="requests-using-r">Requests using R</h4>
<p>We’ll make our request using the <code>GET</code> function and specify the URL:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"http://api.open-notify.org/astros.json"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [http://api.open-notify.org/astros.json]
  Date: 2024-10-07 01:29
  Status: 200
  Content-Type: application/json
  Size: 587 B</code></pre>
</div>
</div>
<p>The output of the <code>GET</code> function is a list that contains all of the information returned by the API server. In other words, the <code>res</code> variable now contains the <strong>response</strong> of the API to our <strong>request</strong>. Calling <code>res</code> gives us a summary of the response. Notice that it prints the URL the request was sent to. We can also see the date and time the request was made, as well as the size of the response.</p>
<p>The status deserves special attention. “Status” refers to the success or failure of the API request, in the form of a number. The number that was returned tells you whether or not the request was a success and, if it failed, can detail some reasons why. The number <code>200</code> corresponds to a success. Information about other status codes <a href="https://www.restapitutorial.com/httpstatuscodes">is provided here</a>.</p>
<p>The actual data is raw Unicode in the <code>res</code> list; we need to convert it into JSON format first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">rawToChar</span>(res<span class="sc">$</span>content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And then from a JSON-structured character vector into a list, using the <code>jsonlite</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>astro <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since this always results in a named list, you can call <code>names()</code> to see the categories of data inside:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(astro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "people"  "number"  "message"</code></pre>
</div>
</div>
<p>You can usually peruse the API documentation to discover what each of these components is (see <a href="http://open-notify.org/Open-Notify-API/People-In-Space/">here</a>, for example). If you visit that link, you’ll learn that <code>message</code> is the status of the API request, <code>number</code> is the current number of people in space, and information on the people themselves is stored in <code>people</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>astro<span class="sc">$</span>people</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      craft                 name
1       ISS       Oleg Kononenko
2       ISS         Nikolai Chub
3       ISS Tracy Caldwell Dyson
4       ISS     Matthew Dominick
5       ISS      Michael Barratt
6       ISS        Jeanette Epps
7       ISS  Alexander Grebenkin
8       ISS        Butch Wilmore
9       ISS      Sunita Williams
10 Tiangong           Li Guangsu
11 Tiangong              Li Cong
12 Tiangong           Ye Guangfu</code></pre>
</div>
</div>
<p>So there you have it; there are (at the time of writing) 12 people in space, 9 on the international space station and 3 on the Tiangong.</p>
</section>
<section id="requests-using-python" class="level4">
<h4 class="anchored" data-anchor-id="requests-using-python">Requests using Python</h4>
<p>We’ll use the <code>requests</code> library, as described in the introduction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> requests.get(<span class="st">"http://api.open-notify.org/astros.json"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Response [200]&gt;</code></pre>
</div>
</div>
<p>Again we see a status code; <code>200</code> tells us everything is good, so we can proceed. We can extract the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>astro <span class="op">=</span> res.json()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similar to <code>names()</code> in R, we can use <code>.keys</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>astro.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dict_keys(['people', 'number', 'message'])</code></pre>
</div>
</div>
<p>And if we want to view the data frame of people currently in space:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(astro[<span class="st">'people'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       craft                  name
0        ISS        Oleg Kononenko
1        ISS          Nikolai Chub
2        ISS  Tracy Caldwell Dyson
3        ISS      Matthew Dominick
4        ISS       Michael Barratt
5        ISS         Jeanette Epps
6        ISS   Alexander Grebenkin
7        ISS         Butch Wilmore
8        ISS       Sunita Williams
9   Tiangong            Li Guangsu
10  Tiangong               Li Cong
11  Tiangong            Ye Guangfu</code></pre>
</div>
</div>
</section>
</section>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">Exercises</h3>
<p>The <a href="https://github.com/15Dkatz/official_joke_api">Official Joke API</a> is another basic API – completely free and open-source, without requiring an API key.</p>
<ol type="1">
<li><p>Write a basic function called <code>tell_me_a_joke</code>. When a user calls the function, it should make an API request and return a random joke (both <code>setup</code> and <code>punchline</code>). Verify that your function works.</p></li>
<li><p>Add an argument to your function allowing you to specify the type of joke. Verify that your function works.</p></li>
</ol>
</section>
<section id="pokeapi" class="level3">
<h3 class="anchored" data-anchor-id="pokeapi">PokeAPI</h3>
<p><a href="https://pokeapi.co/">This API</a> proudly declares itself to provide “all the Pokemon data you’ll ever need in one place,” with “over 2.5 billion API calls each month.” It is a quality free API that doesn’t require the use of an API key; you can experiment with it in your browser at that link, or make requests from it using R or Python. You can also use one of the many wrappers created for this API if you choose. The (somewhat extensive) documentation is <a href="https://pokeapi.co/docs/v2">available here</a>.</p>
<p>Let’s try it out. We’ll request all the information on a specific Pokemon using the <code>/pokemon/</code> endpoint.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"https://pokeapi.co/api/v2/pokemon/37/"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>poke <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(res<span class="sc">$</span>content))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can see from <code>names</code>, we can access a pretty wide variety of information about this Pokemon, from its abilities to its stats to its forms, moves, and even cries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(poke)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "abilities"                "base_experience"         
 [3] "cries"                    "forms"                   
 [5] "game_indices"             "height"                  
 [7] "held_items"               "id"                      
 [9] "is_default"               "location_area_encounters"
[11] "moves"                    "name"                    
[13] "order"                    "past_abilities"          
[15] "past_types"               "species"                 
[17] "sprites"                  "stats"                   
[19] "types"                    "weight"                  </code></pre>
</div>
</div>
<p>Let’s see what the name of number 37 is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>poke<span class="sc">$</span>name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "vulpix"</code></pre>
</div>
</div>
<p>37 is the Vulpix – a little fire fox Pokemon (and my personal favorite):</p>
<p><img src="images/clipboard-3094734148.png" width="282" height="189"></p>
<p>It may seem a little slow to extract information like this – one at a time, changing the ID number each time. Suppose we wanted to extract some basic information, like name, height, and weight, about all the Pokemon. How could we do that from here?</p>
<p>The first step would be to learn how many Pokemon there are. To do that, we can make an API request using the <code>/pokemon/</code> endpoint. We might assume <code>$count</code> reflects how many Pokemon were in the database, but in fact it doesn’t; the actual number is 1,025.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"https://pokeapi.co/api/v2/pokemon/"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(res<span class="sc">$</span>content))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$count
[1] 1302

$`next`
[1] "https://pokeapi.co/api/v2/pokemon/?offset=20&amp;limit=20"

$previous
NULL

$results
         name                                   url
1   bulbasaur  https://pokeapi.co/api/v2/pokemon/1/
2     ivysaur  https://pokeapi.co/api/v2/pokemon/2/
3    venusaur  https://pokeapi.co/api/v2/pokemon/3/
4  charmander  https://pokeapi.co/api/v2/pokemon/4/
5  charmeleon  https://pokeapi.co/api/v2/pokemon/5/
6   charizard  https://pokeapi.co/api/v2/pokemon/6/
7    squirtle  https://pokeapi.co/api/v2/pokemon/7/
8   wartortle  https://pokeapi.co/api/v2/pokemon/8/
9   blastoise  https://pokeapi.co/api/v2/pokemon/9/
10   caterpie https://pokeapi.co/api/v2/pokemon/10/
11    metapod https://pokeapi.co/api/v2/pokemon/11/
12 butterfree https://pokeapi.co/api/v2/pokemon/12/
13     weedle https://pokeapi.co/api/v2/pokemon/13/
14     kakuna https://pokeapi.co/api/v2/pokemon/14/
15   beedrill https://pokeapi.co/api/v2/pokemon/15/
16     pidgey https://pokeapi.co/api/v2/pokemon/16/
17  pidgeotto https://pokeapi.co/api/v2/pokemon/17/
18    pidgeot https://pokeapi.co/api/v2/pokemon/18/
19    rattata https://pokeapi.co/api/v2/pokemon/19/
20   raticate https://pokeapi.co/api/v2/pokemon/20/</code></pre>
</div>
</div>
<p>We also might notice that we only received the first 20 Pokemon. That’s the default for this API. If we want to extract more than that, we have to make a small change.</p>
<section id="query-parameters" class="level4">
<h4 class="anchored" data-anchor-id="query-parameters">Query Parameters</h4>
<p>So far, our <code>GET</code> requests have been fairly straightforward; there was no additional information that we needed to provide. Many APIs either require or allow you to specify a little more information in API calls; additional information we specify are called <strong>query parameters</strong>.</p>
<p>If you’re accessing the API from within R, you can use the <code>query</code> argument, as shown, and provide a named list of query parameters. For this example, let’s set the parameter <code>limit</code> to 30, indicating that we want to retrieve data on 30 Pokemon, rather than the default of 20.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"https://pokeapi.co/api/v2/pokemon/"</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">query =</span> <span class="fu">list</span>(<span class="at">limit =</span> <span class="dv">30</span>))</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(res<span class="sc">$</span>content))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$count
[1] 1302

$`next`
[1] "https://pokeapi.co/api/v2/pokemon/?offset=30&amp;limit=30"

$previous
NULL

$results
         name                                   url
1   bulbasaur  https://pokeapi.co/api/v2/pokemon/1/
2     ivysaur  https://pokeapi.co/api/v2/pokemon/2/
3    venusaur  https://pokeapi.co/api/v2/pokemon/3/
4  charmander  https://pokeapi.co/api/v2/pokemon/4/
5  charmeleon  https://pokeapi.co/api/v2/pokemon/5/
6   charizard  https://pokeapi.co/api/v2/pokemon/6/
7    squirtle  https://pokeapi.co/api/v2/pokemon/7/
8   wartortle  https://pokeapi.co/api/v2/pokemon/8/
9   blastoise  https://pokeapi.co/api/v2/pokemon/9/
10   caterpie https://pokeapi.co/api/v2/pokemon/10/
11    metapod https://pokeapi.co/api/v2/pokemon/11/
12 butterfree https://pokeapi.co/api/v2/pokemon/12/
13     weedle https://pokeapi.co/api/v2/pokemon/13/
14     kakuna https://pokeapi.co/api/v2/pokemon/14/
15   beedrill https://pokeapi.co/api/v2/pokemon/15/
16     pidgey https://pokeapi.co/api/v2/pokemon/16/
17  pidgeotto https://pokeapi.co/api/v2/pokemon/17/
18    pidgeot https://pokeapi.co/api/v2/pokemon/18/
19    rattata https://pokeapi.co/api/v2/pokemon/19/
20   raticate https://pokeapi.co/api/v2/pokemon/20/
21    spearow https://pokeapi.co/api/v2/pokemon/21/
22     fearow https://pokeapi.co/api/v2/pokemon/22/
23      ekans https://pokeapi.co/api/v2/pokemon/23/
24      arbok https://pokeapi.co/api/v2/pokemon/24/
25    pikachu https://pokeapi.co/api/v2/pokemon/25/
26     raichu https://pokeapi.co/api/v2/pokemon/26/
27  sandshrew https://pokeapi.co/api/v2/pokemon/27/
28  sandslash https://pokeapi.co/api/v2/pokemon/28/
29  nidoran-f https://pokeapi.co/api/v2/pokemon/29/
30   nidorina https://pokeapi.co/api/v2/pokemon/30/</code></pre>
</div>
</div>
<p>For APIs that use additional query parameters, you can simply add them to that named list. In Python we can set up a dictionary of query parameters in the form of key-value pairs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"limit"</span>: <span class="dv">30</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> requests.get(<span class="st">"https://pokeapi.co/api/v2/pokemon/"</span>, params<span class="op">=</span>parameters)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>poke <span class="op">=</span> res.json()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(poke[<span class="st">'results'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          name                                    url
0    bulbasaur   https://pokeapi.co/api/v2/pokemon/1/
1      ivysaur   https://pokeapi.co/api/v2/pokemon/2/
2     venusaur   https://pokeapi.co/api/v2/pokemon/3/
3   charmander   https://pokeapi.co/api/v2/pokemon/4/
4   charmeleon   https://pokeapi.co/api/v2/pokemon/5/
5    charizard   https://pokeapi.co/api/v2/pokemon/6/
6     squirtle   https://pokeapi.co/api/v2/pokemon/7/
7    wartortle   https://pokeapi.co/api/v2/pokemon/8/
8    blastoise   https://pokeapi.co/api/v2/pokemon/9/
9     caterpie  https://pokeapi.co/api/v2/pokemon/10/
10     metapod  https://pokeapi.co/api/v2/pokemon/11/
11  butterfree  https://pokeapi.co/api/v2/pokemon/12/
12      weedle  https://pokeapi.co/api/v2/pokemon/13/
13      kakuna  https://pokeapi.co/api/v2/pokemon/14/
14    beedrill  https://pokeapi.co/api/v2/pokemon/15/
15      pidgey  https://pokeapi.co/api/v2/pokemon/16/
16   pidgeotto  https://pokeapi.co/api/v2/pokemon/17/
17     pidgeot  https://pokeapi.co/api/v2/pokemon/18/
18     rattata  https://pokeapi.co/api/v2/pokemon/19/
19    raticate  https://pokeapi.co/api/v2/pokemon/20/
20     spearow  https://pokeapi.co/api/v2/pokemon/21/
21      fearow  https://pokeapi.co/api/v2/pokemon/22/
22       ekans  https://pokeapi.co/api/v2/pokemon/23/
23       arbok  https://pokeapi.co/api/v2/pokemon/24/
24     pikachu  https://pokeapi.co/api/v2/pokemon/25/
25      raichu  https://pokeapi.co/api/v2/pokemon/26/
26   sandshrew  https://pokeapi.co/api/v2/pokemon/27/
27   sandslash  https://pokeapi.co/api/v2/pokemon/28/
28   nidoran-f  https://pokeapi.co/api/v2/pokemon/29/
29    nidorina  https://pokeapi.co/api/v2/pokemon/30/</code></pre>
</div>
</div>
</section>
<section id="making-many-api-calls" class="level4">
<h4 class="anchored" data-anchor-id="making-many-api-calls">Making Many API Calls</h4>
<p>From that lengthy list, we can extract something very useful – the list of ID URLs corresponding to all the Pokemon. Let’s do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="st">"https://pokeapi.co/api/v2/pokemon/"</span>, </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">query =</span> <span class="fu">list</span>(<span class="at">limit =</span> <span class="dv">1025</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>big_poke <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(res<span class="sc">$</span>content))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>big_poke<span class="sc">$</span>results<span class="sc">$</span>url <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://pokeapi.co/api/v2/pokemon/1/"
[2] "https://pokeapi.co/api/v2/pokemon/2/"
[3] "https://pokeapi.co/api/v2/pokemon/3/"
[4] "https://pokeapi.co/api/v2/pokemon/4/"
[5] "https://pokeapi.co/api/v2/pokemon/5/"
[6] "https://pokeapi.co/api/v2/pokemon/6/"</code></pre>
</div>
</div>
<p>If we want to extract the name, height, and weight of all the Pokemon, as discussed before, we could write a loop:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>pokelist <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">1025</span>){</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span> big_poke<span class="sc">$</span>results<span class="sc">$</span>url[i]</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">=</span> <span class="fu">GET</span>(url)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  poke <span class="ot">=</span> <span class="fu">fromJSON</span>(<span class="fu">rawToChar</span>(res<span class="sc">$</span>content))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  pokelist[[i]] <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">name =</span> poke<span class="sc">$</span>name,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">height =</span> poke<span class="sc">$</span>height,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">weight =</span> poke<span class="sc">$</span>weight)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(rbind, pokelist) <span class="sc">%&gt;%</span> </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        name height weight
1  bulbasaur      7     69
2    ivysaur     10    130
3   venusaur     20   1000
4 charmander      6     85
5 charmeleon     11    190
6  charizard     17    905</code></pre>
</div>
</div>
<p>Or in Python, as follows (I’ve set the following code chunk not to evaluate, since it takes a few minutes to run the process of extracting data on all 1,025 and I’d rather avoid doing it twice):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>poke_list <span class="op">=</span> []</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>big_poke <span class="op">=</span> requests.get(<span class="st">"https://pokeapi.co/api/v2/pokemon/?limit=1025"</span>).json()</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1025</span>):</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    url <span class="op">=</span> big_poke[<span class="st">'results'</span>][i][<span class="st">'url'</span>]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> requests.get(url)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the request was successful</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> res.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>        poke <span class="op">=</span> res.json()</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Append the data as a DataFrame to the list</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>        poke_list.append(pd.DataFrame({</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'name'</span>: [poke[<span class="st">'name'</span>]],</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'height'</span>: [poke[<span class="st">'height'</span>]],</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'weight'</span>: [poke[<span class="st">'weight'</span>]]</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        }))</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Failed to retrieve data for URL </span><span class="sc">{</span>url<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>poke_df <span class="op">=</span> pd.concat(poke_list, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(poke_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that this process is essentially taking semi-structured data (in JSON format) and turning it into structured data! We could then use this structured data in any number of machine learning models or create visualizations to our heart’s content.</p>
</section>
<section id="exercises-1" class="level4">
<h4 class="anchored" data-anchor-id="exercises-1">Exercises</h4>
<ol start="3" type="1">
<li>For each of 1,025 Pokemon, extract their (a) name, (b) height, (c) weight, (d) primary type, (e) hp, (f) attack, (g) defense, (h) special attack, and (i) special defense.</li>
<li>Create a scatterplot of the relationship between Pokemon height and weight. Describe what you notice.</li>
</ol>
</section>
</section>
</section>
<section id="apis-with-keys" class="level2">
<h2 class="anchored" data-anchor-id="apis-with-keys">APIs with Keys</h2>
<p>A number of APIs require a key to access them. This is often done for many reasons – for security, or to track user data, or to restrict the number of API calls per user per day (or other period of time). It’s difficult to precisely describe the process of accessing APIs with keys, because the way you generate your key (essentially a password) may vary from application to application, and because everyone’s key will differ.</p>
<p>Some APIs will ask you to pay a fee to use the API or obtain a key. You won’t be required to use a paid API for this course, but you may do so if you choose.</p>
<section id="api-wrappers" class="level3">
<h3 class="anchored" data-anchor-id="api-wrappers">API Wrappers</h3>
<p>R and Python developers have created what are called <strong>wrappers</strong> for many of the more commonly used APIs. If you have an API in particular that you’d like to use, I recommend first searching for wrappers for that API. An API “wrapper” is a tool that allows you to use the API more easily, without having to wade through so much documentation and debugging, by simply using your pre-existing experience with R or Python code to interact with the API. They are called wrappers because they consist of code that is “wrapped” around the underlying API calls.</p>
<section id="spotify-api" class="level4">
<h4 class="anchored" data-anchor-id="spotify-api">Spotify API</h4>
<p>The Spotify API is very popular and free for public use, although it does require you to set up a Client ID, Client Secret, and what is called an access token. You can find a <a href="https://developer.spotify.com/documentation/web-api/tutorials/getting-started">guide to getting started with the API here</a>.</p>
<p>To use the API, you have to log in to the <a href="https://developer.spotify.com/dashboard">Spotify Developer Dashboard</a> and create an app. (Although this sounds like a lot of work, it really means you simply have to click a single button.) You can name the app anything you like; for the “redirect URL,” I recommend <code>http://localhost:3000</code>. Then you need to request an access token. To do that, go to your <a href="https://developer.spotify.com/dashboard">Dashboard</a>. Click on the name of the app you just created; then click on Settings. You’ll want to make a note of your <em>Client ID</em> and <em>Client Secret</em>; you’ll need those to get an access token. The ID and secret are linked to your account and won’t usually change. The access token, however, is only valid for a certain period of time (usually one hour), and will need to be regenerated after that time elapses to continue using the API.</p>
<p>It is much easier to access the Spotify API with a wrapper. My favorite wrapper for this API is <code>spotifyr</code>. Let’s set that package up now. Rather than installing it with <code>install_packages</code>, I recommend installing the R package <code>devtools</code> (or “developer tools”) and then using its function <code>install_github</code> to download the most recent version of <code>spotifyr</code> from <a href="https://github.com/charlie86/spotifyr">its GitHub page.</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("devtools")</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: usethis</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'usethis' was built under R version 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github('charlie86/spotifyr')</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spotifyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the following code, replace the <code>########</code> with your Client ID and Client Secret, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">SPOTIFY_CLIENT_ID =</span> <span class="st">'####################'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">SPOTIFY_CLIENT_SECRET =</span> <span class="st">'###################'</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># access_token &lt;- get_spotify_access_token()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The API documentation for Spotify is extensive. You can find it here. You can also find more information on the various functions in the wrapper package that are available, as well as see some examples of visualizations generated using the Spotify API.</p>
<p>To get information about the audio features of an artist:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># results &lt;- get_artist_audio_features("arctic monkeys")</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exercises-2" class="level4">
<h4 class="anchored" data-anchor-id="exercises-2">Exercises</h4>
<p>Use the Spotify API to extract the audio features for one of your favorite artists. Then answer the following questions.</p>
<ol start="5" type="1">
<li>What is their most common key and time signature? What about least common? (Try using tables and/or bar charts to answer this.)</li>
<li>What are the summary statistics for your favorite artist’s (a) danceability, (b) energy, (c) loudness, (d) acousticness, and (e) energy?</li>
</ol>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>